const board = document.getElementById('drawSvg');
const crlBtn = document.getElementById('circle');
const lneBtn = document.getElementById('line');
const allBtns = document.getElementsByTagName('button');
const rectBtn = document.getElementById('rect');
let activeShape; 
let isDrawing = false;
let svgElement;
let startX = 0;
let startY = 0;


[...allBtns].forEach(btn => btn.addEventListener('click', activeBtn))
board.addEventListener('mousedown', drawShape);
board.addEventListener('mousemove', resizeShape);
board.addEventListener('mouseup', assignShape);
board.addEventListener('mouseleave', assignShape);


function activeBtn(e){
    if(e.target.classList.contains('active')){
        e.target.classList.remove('active');
        activeShape = undefined;
        return;
    }
    [...allBtns].forEach(btn => btn.classList.remove('active'));
    e.target.classList.add('active');
    activeShape = e.target.id;
}

function drawShape(e){
    isDrawing = true;
    startX = e.offsetX;
    startY = e.offsetY;
    if(activeShape === 'circle'){
        svgElement = document.createElementNS("http://www.w3.org/2000/svg", "circle");//WTF
        svgElement.setAttribute('cx', e.offsetX);
        svgElement.setAttribute('cy', e.offsetY);
        svgElement.setAttribute('fill', 'brown');
    }
    else if(activeShape === 'line'){
        svgElement = document.createElementNS("http://www.w3.org/2000/svg", "line");//WTF
        svgElement.setAttribute('x1', e.offsetX);
        svgElement.setAttribute('y1', e.offsetY);
        svgElement.setAttribute('x2', e.offsetX);//to prevent auto line matching to (0,0)
        svgElement.setAttribute('y2', e.offsetY);
        svgElement.setAttribute('stroke', 'brown');
    }
    else if(activeShape === 'rect'){
        svgElement = document.createElementNS("http://www.w3.org/2000/svg", "rect");//WTF
        svgElement.setAttribute('x', e.offsetX);
        svgElement.setAttribute('y', e.offsetY);
        svgElement.setAttribute('width', 0);//to prevent auto line matching to (0,0)
        svgElement.setAttribute('height', 0);
        svgElement.style.fill = "brown";
    }
    else{
        return;//Temporary handling shanon selected shape
    }
    board.appendChild(svgElement);
    svgElement.setAttribute('opacity', '.5');
}

function resizeShape(e){
    if(!isDrawing){
        return;
    }
    if(activeShape === 'circle'){
        let rad = Math.sqrt(Math.abs(startX - e.offsetX)**2 + Math.abs(startY - e.offsetY)**2).toFixed(0);
        svgElement.setAttribute('r', rad);
    }
    else if(activeShape === 'line'){
        svgElement.setAttribute('x2', e.offsetX);
        svgElement.setAttribute('y2', e.offsetY);
    }
    else if(activeShape === 'rect'){
        if(startX > e.offsetX){
            svgElement.setAttribute('x', e.offsetX);
            svgElement.setAttribute('width', startX);
        }
        if(startY > e.offsetY){
        svgElement.setAttribute('y', e.offsetY);
        svgElement.setAttribute('height', startY);
        }
        svgElement.setAttribute('width', Math.abs(e.offsetX - startX));
        svgElement.setAttribute('height', Math.abs(e.offsetY - startY));
    }
}

function assignShape(e){
    if(!isDrawing){
        return;
    };
    if(!activeShape){
        return;
    }
    svgElement.setAttribute('opacity', `1`);
    startX = 0;
    startY = 0;
    isDrawing = false;
};
